# 项目架构说明

## 整体架构

采用前后端分离架构，前端负责用户交互和界面展示，后端负责数据存储和业务逻辑处理。

```
┌─────────────────┐    HTTP/JSON    ┌─────────────────┐
│   HarmonyOS     │ ◄─────────────► │   Spring Boot   │
│   前端应用      │                 │   后端服务      │
│                 │                 │                 │
│ • 用户界面      │                 │ • 数据存储      │
│ • 用户交互      │                 │ • 业务逻辑      │
│ • 状态管理      │                 │ • API服务       │
│ • API调用       │                 │ • 文件管理      │
└─────────────────┘                 └─────────────────┘
```

## 前端职责 (HarmonyOS)

### 核心功能
- **用户界面展示**: 渲染用户数据、提供交互界面
- **用户交互处理**: 处理用户输入、点击、滑动等操作
- **状态管理**: 管理前端状态、用户会话信息
- **API调用**: 向后端发送HTTP请求，获取数据
- **数据展示**: 将后端返回的数据展示给用户

### 主要文件
```
MyApplication/entry/src/main/ets/
├── pages/
│   ├── yourpage.ets      # 个人资料展示页面
│   ├── infopage.ets      # 个人信息编辑页面
│   └── homepage.ets      # 主页
├── service/
│   └── apiservice.ets    # API服务层
├── models/
│   └── userdata.ets      # 前端数据模型
└── common/
    └── components.ets    # 公共组件
```

### 数据流
1. **页面加载** → 调用API获取数据
2. **用户操作** → 发送请求到后端
3. **后端响应** → 更新前端状态
4. **状态更新** → 重新渲染界面

## 后端职责 (Spring Boot)

### 核心功能
- **数据存储管理**: 用户信息、头像文件、聊天记录
- **业务逻辑处理**: 数据验证、业务规则、AI聊天处理
- **API服务提供**: RESTful接口，处理前端请求
- **文件管理**: 头像上传、存储、访问
- **数据持久化**: 数据库操作、文件系统管理

### 主要文件
```
backend/MyApplication/src/main/java/com/ai/companion/
├── controller/
│   ├── UserController.java         # 用户管理API
│   ├── ChatController.java         # AI聊天API
│   └── ChatHistoryController.java  # 聊天历史API
├── service/
│   ├── UserService.java            # 用户服务接口
│   └── impl/
│       └── UserServiceImpl.java    # 用户服务实现
├── entity/
│   ├── User.java                   # 用户实体
│   └── vo/                         # 视图对象
├── config/
│   ├── WebConfig.java              # Web配置
│   └── AIComConfig.java            # AI配置
└── MyApplication.java              # 主启动类
```

## 前后端协作流程

### 1. 用户信息展示流程
```
前端 (yourpage.ets)          后端 (UserController)
     │                            │
     │ 1. 页面加载                │
     │                            │
     │ 2. 调用 getUserInfo()      │
     │───────────────────────────►│
     │                            │ 3. 查询用户数据
     │                            │
     │                            │ 4. 返回用户信息
     │ 5. 接收响应                │
     │◄───────────────────────────│
     │                            │
     │ 6. 更新界面显示            │
     │                            │
```

### 2. 用户信息编辑流程
```
前端 (infopage.ets)          后端 (UserController)
     │                            │
     │ 1. 用户输入新信息          │
     │                            │
     │ 2. 调用 updateUserInfo()   │
     │───────────────────────────►│
     │                            │ 3. 验证数据
     │                            │
     │                            │ 4. 更新数据库
     │                            │
     │                            │ 5. 返回更新结果
     │ 6. 接收响应                │
     │◄───────────────────────────│
     │                            │
     │ 7. 更新界面显示            │
     │                            │
```

### 3. 头像上传流程
```
前端 (infopage.ets)          后端 (UserController)
     │                            │
     │ 1. 用户选择图片            │
     │                            │
     │ 2. 调用 uploadAvatar()     │
     │───────────────────────────►│
     │                            │ 3. 保存文件
     │                            │
     │                            │ 4. 更新用户信息
     │                            │
     │                            │ 5. 返回文件URL
     │ 6. 接收响应                │
     │◄───────────────────────────│
     │                            │
     │ 7. 更新头像显示            │
     │                            │
```

## API接口规范

### 请求格式
```javascript
// GET请求
fetch('/api/user/100000000')

// POST请求
fetch('/api/user/100000000', {
  method: 'PUT',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(data)
})
```

### 响应格式
```json
{
  "success": true,
  "message": "操作成功",
  "data": { /* 具体数据 */ },
  "timestamp": 1705312200000
}
```

## 技术栈对比

| 方面 | 前端 (HarmonyOS) | 后端 (Spring Boot) |
|------|------------------|-------------------|
| **语言** | TypeScript/ArkTS | Java 17 |
| **框架** | HarmonyOS SDK | Spring Boot 3.5.3 |
| **UI** | ArkUI | 无 (API服务) |
| **存储** | 内存状态 | 内存/数据库 |
| **网络** | HTTP客户端 | HTTP服务器 |
| **职责** | 界面展示、用户交互 | 数据处理、业务逻辑 |

## 协作原则

### 前端原则
1. **专注界面**: 只负责界面展示和用户交互
2. **数据驱动**: 通过API获取数据，不直接操作数据
3. **状态同步**: 保持前端状态与后端数据同步
4. **错误处理**: 优雅处理API错误，提供用户反馈

### 后端原则
1. **数据安全**: 负责数据验证、存储和访问控制
2. **业务逻辑**: 处理复杂的业务规则和计算
3. **API设计**: 提供清晰、一致的API接口
4. **性能优化**: 优化数据库查询和文件处理

### 协作原则
1. **接口约定**: 前后端通过API接口进行数据交换
2. **数据格式**: 使用JSON作为数据交换格式
3. **错误处理**: 统一的错误响应格式
4. **版本管理**: API版本控制和向后兼容

## 开发流程

1. **需求分析** → 确定前后端职责分工
2. **API设计** → 定义接口规范和数据格式
3. **并行开发** → 前后端同时开发
4. **接口联调** → 测试前后端协作