// userdata.ets
// ç”¨æˆ·æ•°æ®æ¨¡å‹

import { UserInfo } from '../common/types';

export class UserData {
  userName: string = 'ç”¨æˆ·';
  userUID: string = '100000000';
  userAvatar: string = '';
  isPrivacyVisible: boolean = false;

  constructor(userName?: string, userUID?: string, userAvatar?: string, isPrivacyVisible?: boolean) {
    if (userName) this.userName = userName;
    if (userUID) this.userUID = userUID;
    if (userAvatar) this.userAvatar = userAvatar;
    if (isPrivacyVisible !== undefined) this.isPrivacyVisible = isPrivacyVisible;
  }

  // æ›´æ–°ç”¨æˆ·åç§°
  updateUserName(newName: string): void {
    this.userName = newName;
  }

  // æ›´æ–°ç”¨æˆ·UID
  updateUserUID(newUID: string): void {
    this.userUID = newUID;
  }

  // æ›´æ–°ç”¨æˆ·å¤´åƒ
  updateUserAvatar(newAvatar: string): void {
    console.log('ğŸ‘¤ [UserData] æ›´æ–°å¤´åƒ:', newAvatar);
    this.userAvatar = newAvatar;
  }

  // æ¸…é™¤å¤´åƒç¼“å­˜ï¼ˆå¼ºåˆ¶åˆ·æ–°ï¼‰
  clearAvatarCache(): void {
    console.log('ğŸ”„ [UserData] æ¸…é™¤å¤´åƒç¼“å­˜');
    this.userAvatar = '';
  }

  // åˆ‡æ¢éšç§å¯è§æ€§
  togglePrivacy(): void {
    this.isPrivacyVisible = !this.isPrivacyVisible;
  }

  // è·å–ç”¨æˆ·ä¿¡æ¯
  getUserInfo(): UserInfo {
    return {
      userName: this.userName,
      userUID: this.userUID,
      userAvatar: this.userAvatar,
      isPrivacyVisible: this.isPrivacyVisible,
      level: '1',
      gender: 'ä¿å¯†',
      signature: 'è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ç•™ä¸‹',
      registerTime: new Date().toISOString(),
      updateTime: new Date().toISOString()
    };
  }
}

// å…¨å±€ç”¨æˆ·æ•°æ®å®ä¾‹
export const globalUserData = new UserData();
