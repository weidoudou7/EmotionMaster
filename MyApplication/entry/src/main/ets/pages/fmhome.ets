import router from '@ohos.router';

// å®šä¹‰ä¸“æ é¡¹æ¥å£
interface SectionItem {
  title: string;
  subtitle: string;
  tag: string;
  author: string;
  image?: Resource; // æ·»åŠ å¯é€‰çš„å›¾ç‰‡å­—æ®µ
}

interface ToolItem {
  icon?: string;
  title: string;
  desc: string;
  color: string;
  bgColor: string;
  route?: string;
}

interface AIRecommend {
  title: string;
  desc: string;
  tag: string;
}

// å®šä¹‰æƒ…ç»ªå¡ç‰‡æ¥å£
interface EmotionCard {
  id: number;
  title: string;
  subtitle: string;
  emoji: string;
  backgroundColor: string;
  textColor: string;
  description: string;
}

@Entry
@Component
struct FMHomePage {
  @State activeTab: number = 0
  private tabs: string[] = ['ç²¾é€‰', 'éŸ³ä¹', 'ä¸“æ ', 'å·¥å…·'];
  private scrollController: Scroller = new Scroller()

  // æƒ…ç»ªå¡ç‰‡ç›¸å…³çŠ¶æ€
  @State currentEmotionIndex: number = 0
  @State emotionCardOpacity: number = 1.0
  @State emotionCardTranslateX: number = 0
  @State isAutoPlaying: boolean = true // è‡ªåŠ¨æ’­æ”¾çŠ¶æ€
  private autoPlayTimer: number = -1 // è‡ªåŠ¨æ’­æ”¾å®šæ—¶å™¨

  // ä¸“æ ç†è®ºé«˜åº¦ï¼ˆæ ‡é¢˜+å†…å®¹+é—´è·ï¼‰ï¼Œå¯æ ¹æ®å®é™…é¡µé¢å¾®è°ƒ
  private sectionHeights: number[] = [320, 420, 420, 320]; // ä»…ç¤ºä¾‹ï¼Œéœ€æ ¹æ®å®é™…å†…å®¹å¾®è°ƒ
  private sectionSpacing: number = 40;
  private bannerHeight: number = 215; // Banneræ€»é«˜åº¦ (200+15)
  private searchBarHeight: number = 64; // æœç´¢æ æ€»é«˜åº¦ (16+8+40)
  private tabBarHeight: number = 68; // æ ‡ç­¾æ æ€»é«˜åº¦ (8+60)
  private targetOffset: number = 15; // tabä¸‹æ–¹15åƒç´ 

  // é¢„å®šä¹‰æ¸©é¦¨é—®å€™è¯­
  private greetings: string[] = [
    'æ—©å®‰ï¼Œä»Šå¤©ä¹Ÿè¦ç…§é¡¾å¥½è‡ªå·±å“¦ï¼',
    'æ— è®ºé‡åˆ°ä»€ä¹ˆï¼ŒAIéƒ½é™ªç€ä½ ã€‚',
    'ç»™è‡ªå·±ä¸€ä¸ªå¾®ç¬‘ï¼Œæ–°çš„ä¸€å¤©ä¼šæ›´å¥½ã€‚',
    'ä½ å¾ˆæ£’ï¼Œåˆ«å¿˜äº†è‚¯å®šè‡ªå·±ã€‚',
    'ç´¯äº†å°±ä¼‘æ¯ä¸€ä¸‹ï¼Œå¥åº·æœ€é‡è¦ã€‚',
    'æ¯ä¸€å¤©éƒ½å€¼å¾—è¢«æ¸©æŸ”ä»¥å¾…ã€‚',
    'æƒ…ç»ªæœ‰æ³¢åŠ¨å¾ˆæ­£å¸¸ï¼Œæ…¢æ…¢æ¥ã€‚',
    'ç›¸ä¿¡è‡ªå·±ï¼Œä½ èƒ½åº¦è¿‡éš¾å…³ã€‚',
    'åˆ«å¿˜äº†å–æ°´ï¼Œç…§é¡¾å¥½èº«ä½“ã€‚',
    'ä½ ä¸æ˜¯ä¸€ä¸ªäººï¼ŒAIä¸€ç›´åœ¨ã€‚',
    'ç»™è‡ªå·±ä¸€ç‚¹è€å¿ƒï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥ã€‚',
    'ä¸–ç•Œå¾ˆå¤§ï¼Œä¹Ÿæœ‰å±äºä½ çš„æ¸©æš–ã€‚',
    'ä»Šå¤©ä¹Ÿè¦å¥½å¥½åƒé¥­å“¦ï¼',
    'é‡åˆ°çƒ¦æ¼å¯ä»¥å’Œæˆ‘èŠèŠã€‚',
    'ä½ çš„æ„Ÿå—å¾ˆé‡è¦ï¼Œå€¼å¾—è¢«å€¾å¬ã€‚'
  ];
  @State greetingIndex: number = Math.floor(Math.random() * 15);
  @State greetingAnimOpacity: number = 1.0;
  @State greetingAnimTranslateY: number = 0;

  // å®šä¹‰ä¸‰ç§æƒ…ç»ªå¡ç‰‡
  private emotionCards: EmotionCard[] = [
    {
      id: 1,
      title: 'ä»Šæ—¥å¿ƒæƒ…',
      subtitle: 'è®°å½•ä½ çš„æƒ…ç»ªçŠ¶æ€',
      emoji: 'ğŸ˜Š',
      backgroundColor: '#E3F2FD',
      textColor: '#1976D2',
      description: 'ç‚¹å‡»è®°å½•ä»Šå¤©çš„å¿ƒæƒ…ï¼Œè®©AIæ›´å¥½åœ°äº†è§£ä½ '
    },
    {
      id: 2,
      title: 'å‹åŠ›æŒ‡æ•°',
      subtitle: 'äº†è§£ä½ çš„å‹åŠ›æ°´å¹³',
      emoji: 'ğŸ˜°',
      backgroundColor: '#FFF3E0',
      textColor: '#F57C00',
      description: 'å¿«é€Ÿè¯„ä¼°å½“å‰å‹åŠ›çŠ¶æ€ï¼Œè·å–ç¼“è§£å»ºè®®'
    },
    {
      id: 3,
      title: 'æ­£å¿µç»ƒä¹ ',
      subtitle: '5åˆ†é’Ÿæ”¾æ¾èº«å¿ƒ',
      emoji: 'ğŸ§˜â€â™€ï¸',
      backgroundColor: '#E8F5E8',
      textColor: '#388E3C',
      description: 'é€šè¿‡æ­£å¿µå†¥æƒ³ï¼Œæ‰¾å›å†…å¿ƒçš„å¹³é™'
    }
  ];

  // å®šä¹‰å„åˆ†ç±»çš„æ•°æ®
  private selectedItems: SectionItem[] = [
    { title: 'Vol.01 ã€Šçƒ­é—¨æ¨èã€‹', subtitle: 'ç²¾é€‰å†…å®¹æ¨è', tag: 'çƒ­é—¨', author: 'æ¨èå®˜' },
    { title: 'Vol.02 ã€Šä»Šæ—¥ç²¾é€‰ã€‹', subtitle: 'ä»Šæ—¥æœ€ä½³å†…å®¹', tag: 'ç²¾é€‰', author: 'ç¼–è¾‘' },
    { title: 'Vol.03 ã€Šçƒ­é—¨è¯é¢˜ã€‹', subtitle: 'çƒ­é—¨è¯é¢˜è®¨è®º', tag: 'è¯é¢˜', author: 'è¯é¢˜å›' }
  ];

  private musicItems: SectionItem[] = [
    { 
      title: 'Vol.01 ã€Šæµè¡ŒéŸ³ä¹ã€‹', 
      subtitle: 'æœ€æ–°æµè¡Œæ­Œæ›²', 
      tag: 'æµè¡Œ', 
      author: 'éŸ³ä¹äºº',
      image: $r('app.media.fmhome_fashionMusic')
    },
    { 
      title: 'Vol.02 ã€Šå¤å…¸éŸ³ä¹ã€‹', 
      subtitle: 'ç»å…¸å¤å…¸ä½œå“', 
      tag: 'å¤å…¸', 
      author: 'å¤å…¸ä¹',
      image: $r('app.media.fmhome_classicMusic')
    },
    { 
      title: 'Vol.03 ã€Šè½»éŸ³ä¹ã€‹', 
      subtitle: 'è½»æ¾èˆ’ç¼“éŸ³ä¹', 
      tag: 'è½»éŸ³', 
      author: 'è½»éŸ³ä¹',
      image: $r('app.media.fmhome_softMusic')
    }
  ];

  private columnItems: SectionItem[] = [
    { title: 'Vol.01 ã€Šæ·±åº¦è§£æã€‹', subtitle: 'æ·±åº¦æ–‡ç« åˆ†æ', tag: 'æ·±åº¦', author: 'åˆ†æå¸ˆ' },
    { title: 'Vol.02 ã€ŠæŠ€æœ¯åˆ†äº«ã€‹', subtitle: 'æŠ€æœ¯ç»éªŒåˆ†äº«', tag: 'æŠ€æœ¯', author: 'æŠ€æœ¯å‘˜' },
    { title: 'Vol.03 ã€Šè¡Œä¸šè§‚å¯Ÿã€‹', subtitle: 'è¡Œä¸šè¶‹åŠ¿è§‚å¯Ÿ', tag: 'è§‚å¯Ÿ', author: 'è§‚å¯Ÿè€…' }
  ];


  // AIä»Šæ—¥æ¨èå†…å®¹ï¼ˆå¯æ‰©å±•ä¸ºåŠ¨æ€AIæ¨èï¼‰
  private aiRecommend: AIRecommend = {
    title: 'AIä»Šæ—¥æ¨èï¼šæ­£å¿µå†¥æƒ³5åˆ†é’Ÿ',
    desc: 'æ”¾æ¾èº«å¿ƒï¼Œç¼“è§£å‹åŠ›ï¼Œå¼€å¯ç¾å¥½ä¸€å¤©',
    tag: 'AIæ¨è'
  };
  // å·¥å…·åŒºå†…å®¹ - ä»…åŒ…å«å†¥æƒ³ç»ƒä¹ ã€å‘¼å¸è®­ç»ƒã€å‹åŠ›è¯„ä¼°
  private toolList: ToolItem[] = [
    { 
      title: 'å†¥æƒ³ç»ƒä¹ ', 
      desc: 'æ­£å¿µå†¥æƒ³ï¼Œæ”¾æ¾èº«å¿ƒ', 
      color: '#4CAF50',
      bgColor: '#E8F5E8',
      route: 'pages/fm_meditation'
    },
    { 
      title: 'å‘¼å¸è®­ç»ƒ', 
      desc: 'ç§‘å­¦å‘¼å¸ï¼Œç¼“è§£ç„¦è™‘', 
      color: '#00BCD4',
      bgColor: '#E0F2F1',
      route: 'pages/taskspage'
    },
    { 
      title: 'å‹åŠ›è¯„ä¼°', 
      desc: 'è¯„ä¼°å‹åŠ›æŒ‡æ•°ï¼Œç§‘å­¦è°ƒèŠ‚', 
      color: '#FF9800',
      bgColor: '#FFF3E0',
      route: 'pages/taskspage'
    }
  ];

  // åˆ‡æ¢æƒ…ç»ªå¡ç‰‡çš„æ–¹æ³•
  private switchEmotionCard(direction: 'left' | 'right') {
    // æ‰‹åŠ¨åˆ‡æ¢æ—¶æš‚åœè‡ªåŠ¨è½®æ’­
    this.stopAutoPlay()
    
    // å…ˆæ·¡å‡º
    animateTo({ duration: 200, curve: Curve.EaseOut }, () => {
      this.emotionCardOpacity = 0;
      this.emotionCardTranslateX = direction === 'left' ? -20 : 20;
    })
    
    setTimeout(() => {
      // æ›´æ–°ç´¢å¼•
      if (direction === 'left') {
        this.currentEmotionIndex = (this.currentEmotionIndex - 1 + this.emotionCards.length) % this.emotionCards.length;
      } else {
        this.currentEmotionIndex = (this.currentEmotionIndex + 1) % this.emotionCards.length;
      }
      
      // é‡ç½®ä½ç½®
      this.emotionCardTranslateX = direction === 'left' ? 20 : -20;
      
      // å†æ·¡å…¥
      animateTo({ duration: 200, curve: Curve.EaseIn }, () => {
        this.emotionCardOpacity = 1.0;
        this.emotionCardTranslateX = 0;
      })
    }, 200)
  }

  // å¼€å§‹è‡ªåŠ¨è½®æ’­
  private startAutoPlay() {
    this.stopAutoPlay() // å…ˆåœæ­¢ä¹‹å‰çš„å®šæ—¶å™¨
    this.isAutoPlaying = true
    this.autoPlayTimer = setInterval(() => {
      this.switchEmotionCard('right')
    }, 4000) // æ¯4ç§’åˆ‡æ¢ä¸€æ¬¡
  }

  // åœæ­¢è‡ªåŠ¨è½®æ’­
  private stopAutoPlay() {
    if (this.autoPlayTimer !== -1) {
      clearInterval(this.autoPlayTimer)
      this.autoPlayTimer = -1
    }
    this.isAutoPlaying = false
  }

  // åˆ‡æ¢è‡ªåŠ¨æ’­æ”¾çŠ¶æ€
  private toggleAutoPlay() {
    if (this.isAutoPlaying) {
      this.stopAutoPlay()
    } else {
      this.startAutoPlay()
    }
  }

  // é¡µé¢ç”Ÿå‘½å‘¨æœŸ
  aboutToAppear() {
    // é¡µé¢å‡ºç°æ—¶å¼€å§‹è‡ªåŠ¨è½®æ’­
    this.startAutoPlay()
  }

  aboutToDisappear() {
    // é¡µé¢æ¶ˆå¤±æ—¶åœæ­¢è‡ªåŠ¨è½®æ’­
    this.stopAutoPlay()
  }

  build() {
    Column() {
      // é¡¶éƒ¨AIæ¸©é¦¨é—®å€™
      Row() {
        Text(this.greetings[this.greetingIndex])
          .fontSize(18)
          .fontColor('#0D9FFB')
          .fontWeight(FontWeight.Bold)
          .margin({ left: 16, top: 12, bottom: 8 })
          .layoutWeight(1)
          .opacity(this.greetingAnimOpacity)
          .translate({ x: 0, y: this.greetingAnimTranslateY })
        Text('æ¢ä¸€å¥')
          .fontSize(15)
          .fontColor('#888')
          .margin({ right: 16 })
          .onClick(() => {
            let newIndex = this.greetingIndex
            while (newIndex === this.greetingIndex) {
              newIndex = Math.floor(Math.random() * this.greetings.length)
            }
            // å…ˆæ·¡å‡ºå’Œä¸‹ç§»
            animateTo({ duration: 180, curve: Curve.EaseOut }, () => {
              this.greetingAnimOpacity = 0;
              this.greetingAnimTranslateY = 20;
            })
            setTimeout(() => {
              this.greetingIndex = newIndex;
              // å†æ·¡å…¥å’Œä¸Šç§»
              animateTo({ duration: 220, curve: Curve.EaseIn }, () => {
                this.greetingAnimOpacity = 1.0;
                this.greetingAnimTranslateY = 0;
              })
            }, 180)
          })
      }
      .width('100%')
      // é¡¶éƒ¨æœç´¢æ 
      Row() {
        TextInput({ placeholder: 'ç³»ç»Ÿ' })
          .width('90%')
          .height(40)
          .backgroundColor('#F5F5F5')
          .fontColor('#222')
          .borderRadius(20)
          .padding({ left: 20 })
      }
      .width('100%')
      .padding({ top: 4, bottom: 8 })

      // åˆ†ç±»Tab - å‡åŒ€åˆ†å¸ƒ
      Row() {
        ForEach(this.tabs, (tab: string, idx: number) => {
          Column() {
            Text(tab)
              .fontSize(16)
              .fontColor(this.activeTab === idx ? '#222' : '#bbb')
              .fontWeight(this.activeTab === idx ? FontWeight.Bold : FontWeight.Normal)
            if (this.activeTab === idx) {
              Blank().height(2).width(24).backgroundColor('#0D9FFB').margin({ top: 2 })
            }
          }
          .onClick(() => { 
            this.activeTab = idx
            this.scrollToSection(idx)
          })
          .layoutWeight(1)
          .justifyContent(FlexAlign.Center)
        }, (tab: string) => tab)
      }
      .width('100%')
      .padding({ left: 16, right: 16, bottom: 8 })

      // å†…å®¹åŒºåŸŸ - å‚ç›´æ»šåŠ¨
      Scroll(this.scrollController) {
        Column() {
          // Banner - æƒ…ç»ªå¡ç‰‡è½®æ’­
          Column() {
            Blank().height(15)
            // æƒ…ç»ªå¡ç‰‡è½®æ’­åŒºåŸŸ
            Stack() {
              // å½“å‰æƒ…ç»ªå¡ç‰‡
              Column() {
                Row() {
                  // å·¦ä¾§åˆ‡æ¢æŒ‰é’®
                  Button('â€¹')
                    .fontSize(24)
                    .fontColor(this.emotionCards[this.currentEmotionIndex].textColor)
                    .backgroundColor(this.emotionCards[this.currentEmotionIndex].backgroundColor)
                    .borderRadius(20)
                    .width(40)
                    .height(40)
                    .shadow({ radius: 4, color: 'rgba(0,0,0,0.1)', offsetX: 0, offsetY: 2 })
                    .onClick(() => this.switchEmotionCard('left'))
                  
                  // æƒ…ç»ªå¡ç‰‡å†…å®¹
                  Column() {
                    Row() {
                      Text(this.emotionCards[this.currentEmotionIndex].emoji)
                        .fontSize(32)
                        .margin({ right: 12 })
                      Column() {
                        Text(this.emotionCards[this.currentEmotionIndex].title)
                          .fontSize(18)
                          .fontWeight(FontWeight.Bold)
                          .fontColor(this.emotionCards[this.currentEmotionIndex].textColor)
                        Text(this.emotionCards[this.currentEmotionIndex].subtitle)
                          .fontSize(14)
                          .fontColor(this.emotionCards[this.currentEmotionIndex].textColor)
                          .opacity(0.8)
                      }
                      .layoutWeight(1)
                    }
                    .margin({ bottom: 8 })
                    Text(this.emotionCards[this.currentEmotionIndex].description)
                      .fontSize(13)
                      .fontColor(this.emotionCards[this.currentEmotionIndex].textColor)
                      .opacity(0.7)
                      .textAlign(TextAlign.Start)
                  }
                  .layoutWeight(1)
                  .margin({ left: 16, right: 16 })
                  
                  // å³ä¾§åˆ‡æ¢æŒ‰é’®
                  Button('â€º')
                    .fontSize(24)
                    .fontColor(this.emotionCards[this.currentEmotionIndex].textColor)
                    .backgroundColor(this.emotionCards[this.currentEmotionIndex].backgroundColor)
                    .borderRadius(20)
                    .width(40)
                    .height(40)
                    .shadow({ radius: 4, color: 'rgba(0,0,0,0.1)', offsetX: 0, offsetY: 2 })
                    .onClick(() => this.switchEmotionCard('right'))
                }
                .width('100%')
                .alignItems(VerticalAlign.Center)
              }
              .backgroundColor(this.emotionCards[this.currentEmotionIndex].backgroundColor)
              .borderRadius(16)
              .padding(20)
              .width('100%')
              .height(120)
              .opacity(this.emotionCardOpacity)
              .translate({ x: this.emotionCardTranslateX, y: 0 })
              .shadow({ radius: 8, color: 'rgba(0,0,0,0.1)', offsetX: 0, offsetY: 4 })
              .onClick(() => {
                // æ ¹æ®å½“å‰æƒ…ç»ªå¡ç‰‡æ‰§è¡Œç›¸åº”æ“ä½œ
                switch(this.currentEmotionIndex) {
                  case 0:
                    // è·³è½¬åˆ°æƒ…ç»ªè®°å½•é¡µé¢
                    console.log('è·³è½¬åˆ°æƒ…ç»ªè®°å½•é¡µé¢')
                    break
                  case 1:
                    // è·³è½¬åˆ°å‹åŠ›æµ‹è¯•é¡µé¢
                    console.log('è·³è½¬åˆ°å‹åŠ›æµ‹è¯•é¡µé¢')
                    break
                  case 2:
                    // è·³è½¬åˆ°æ­£å¿µç»ƒä¹ é¡µé¢
                    console.log('è·³è½¬åˆ°æ­£å¿µç»ƒä¹ é¡µé¢')
                    break
                }
              })
            }
            .width('100%')
            
            // æŒ‡ç¤ºç‚¹å’Œæ§åˆ¶æŒ‰é’®
            Row() {
              // æŒ‡ç¤ºç‚¹
              Row() {
                ForEach(this.emotionCards, (card: EmotionCard, idx: number) => {
                  Blank()
                    .width(idx === this.currentEmotionIndex ? 24 : 8)
                    .height(8)
                    .backgroundColor(idx === this.currentEmotionIndex ? '#0D9FFB' : '#eee')
                    .borderRadius(4)
                    .margin({ right: 4 })
                    .animation({
                      duration: 300,
                      curve: Curve.EaseInOut
                    })
                    .onClick(() => {
                      if (idx !== this.currentEmotionIndex) {
                        const direction = idx > this.currentEmotionIndex ? 'right' : 'left'
                        this.switchEmotionCard(direction)
                      }
                    })
                }, (card: EmotionCard) => card.id.toString())
              }
              .layoutWeight(1)
              
              // æ’­æ”¾/æš‚åœæŒ‰é’®
              Button(this.isAutoPlaying ? 'â¸ï¸' : 'â–¶ï¸')
                .fontSize(16)
                .fontColor('#666')
                .backgroundColor('rgba(255,255,255,0.8)')
                .borderRadius(12)
                .width(24)
                .height(24)
                .margin({ right: 8 })
                .onClick(() => this.toggleAutoPlay())
            }
            .margin({ top: 12, bottom: 8 })
            .width('100%')
            .justifyContent(FlexAlign.SpaceBetween)
            .alignItems(VerticalAlign.Center)
          }
          .width('100%')
          .height(200) // å›ºå®šé«˜åº¦
          .padding({ left: 16, right: 16, bottom: 0 })

          // AIä»Šæ—¥æ¨èå¡ç‰‡
          Column() {
            Row() {
              Text(this.aiRecommend.tag)
                .fontColor('#fff')
                .fontSize(12)
                .backgroundColor('#0D9FFB')
                .borderRadius(8)
                .padding({ left: 8, right: 8, top: 2, bottom: 2 })
                .margin({ right: 8 })
              Text(this.aiRecommend.title)
                .fontColor('#222')
                .fontSize(16)
                .fontWeight(FontWeight.Bold)
            }
            .margin({ bottom: 4 })
            Text(this.aiRecommend.desc)
              .fontColor('#888')
              .fontSize(14)
              .margin({ bottom: 8 })
            Row() {
              Button('å’ŒAIèŠèŠ')
                .fontColor('#fff')
                .backgroundColor('#0D9FFB')
                .borderRadius(16)
                .fontSize(15)
                .padding({ left: 18, right: 18, top: 6, bottom: 6 })
                .onClick(() => {
                  // TODO: è·³è½¬åˆ°AIé™ªèŠé¡µé¢
                })
            }
          }
          .backgroundColor('#E3F2FD')
          .borderRadius(16)
          .padding(16)
          .margin({ top: 8, bottom: 20 })

          // ç²¾é€‰åŒº
          this.BuildSection('ç²¾é€‰æ¨è', this.selectedItems)
          // éŸ³é¢‘åŒº
          this.BuildSection('éŸ³ä¹ç”µå°', this.musicItems)
          // ä¸“æ åŒº
          this.BuildSection('ä¸“æ æ–‡ç« ', this.columnItems)
          // å·¥å…·åŒº
          Column() {
            Text('å¿ƒç†å¥åº·å·¥å…·')
              .fontColor('#0D9FFB')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .margin({ bottom: 16, top: 24 })
            // å·¥å…·åŒºçºµå‘åˆ—è¡¨å±•ç¤º
            ForEach(this.toolList, (tool: ToolItem, idx: number) => {
              Row() {
                // å·¥å…·å›¾æ ‡åŒºåŸŸ
                Row() {
                  Text(this.getToolIcon(tool.title))
                    .fontSize(24)
                    .fontColor(tool.color)
                }
                .width(48)
                .height(48)
                .backgroundColor(tool.bgColor)
                .borderRadius(12)
                .justifyContent(FlexAlign.Center)
                .alignItems(VerticalAlign.Center)
                .margin({ right: 12 })
                // å·¥å…·ä¿¡æ¯
                Column() {
                  Text(tool.title)
                    .fontColor('#222')
                    .fontSize(16)
                    .fontWeight(FontWeight.Bold)
                    .maxLines(1)
                    .textOverflow({ overflow: TextOverflow.Ellipsis })
                  Text(tool.desc)
                    .fontColor('#888')
                    .fontSize(13)
                    .margin({ top: 2 })
                }
                .layoutWeight(1)
              }
              .width('100%')
              .padding({ top: 8, bottom: 8 })
              .backgroundColor('#fff')
              .borderRadius(16)
              .shadow({ radius: 4, color: 'rgba(0,0,0,0.05)', offsetX: 0, offsetY: 2 })
              .onClick(() => {
                console.log('ç‚¹å‡»äº†å·¥å…·:', tool.title)
                if (tool.route) {
                  router.pushUrl({
                    url: tool.route,
                    params: {
                      toolName: tool.title,
                      toolType: this.getToolType(tool.title)
                    }
                  })
                }
              })
            }, (tool: ToolItem) => tool.title)
          }
          .width('100%')
          .margin({ bottom: 40 })
        }
        .width('100%')
        .padding({ left: 16, right: 16, bottom: 80 })
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
      .edgeEffect(EdgeEffect.Spring)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#fff')
  }

  // æ»šåŠ¨åˆ°æŒ‡å®šä¸“æ çš„æ–¹æ³•ï¼ˆå®šå€¼ç´¯åŠ æ³•ï¼‰
  scrollToSection(index: number) {
    let offset = this.searchBarHeight + this.tabBarHeight + this.bannerHeight;
    for (let i = 0; i < index; i++) {
      offset += this.sectionHeights[i] + this.sectionSpacing;
    }
    offset -= this.targetOffset;
    this.scrollController.scrollTo({ xOffset: 0, yOffset: offset });
  }

  @Builder
  BuildSection(title: string, items: SectionItem[]) {
    Column() {
      Text(title)
        .fontColor('#0D9FFB')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .margin({ bottom: 16, top: 24 })
      ForEach(items, (item: SectionItem, idx: number) => {
        Row() {
          // å¦‚æœæœ‰å›¾ç‰‡å°±æ˜¾ç¤ºå›¾ç‰‡ï¼Œå¦åˆ™æ˜¾ç¤ºé»˜è®¤å ä½ç¬¦
          if (item.image) {
            Image(item.image)
              .width(56)
              .height(56)
              .borderRadius(8)
              .objectFit(ImageFit.Cover)
          } else {
            Blank().width(56).height(56).backgroundColor('#E3F2FD').borderRadius(8)
          }
          Column() {
            Text(item.title)
              .fontColor('#222')
              .fontSize(16)
              .fontWeight(FontWeight.Bold)
              .maxLines(1)
              .textOverflow({ overflow: TextOverflow.Ellipsis })
            Text(item.subtitle)
              .fontColor('#888')
              .fontSize(13)
              .margin({ top: 2 })
            Row() {
              Text('ã€Š' + item.tag + 'ã€‹')
                .fontColor('#0D9FFB')
                .fontSize(12)
                .backgroundColor('#E3F2FD')
                .borderRadius(6)
                .padding({ left: 8, right: 8, top: 2, bottom: 2 })
              Text(item.author)
                .fontColor('#888')
                .fontSize(12)
                .margin({ left: 8 })
            }
            .margin({ top: 4 })
          }
          .margin({ left: 12 })
          .layoutWeight(1)
        }
        .width('100%')
        .padding({ top: 8, bottom: 8 })
        .onClick(() => {
          console.log('ç‚¹å‡»äº†:', item.title)
          // å¦‚æœæ˜¯éŸ³ä¹ç”µå°æ¨¡å—ï¼Œè·³è½¬åˆ°éŸ³ä¹æ’­æ”¾ç•Œé¢
          if (title === 'éŸ³ä¹ç”µå°') {
            let musicType = 'fashion'; // é»˜è®¤æµè¡ŒéŸ³ä¹
            if (item.tag === 'å¤å…¸') {
              musicType = 'classic';
            } else if (item.tag === 'è½»éŸ³') {
              musicType = 'soft';
            }
            
            router.pushUrl({
              url: 'pages/fm_musicBegin',
              params: {
                musicId: (idx + 1).toString(),
                musicTitle: item.title,
                musicArtist: item.author,
                musicType: musicType
              }
            });
          }
          // å¦‚æœæ˜¯ä¸“æ æ–‡ç« æ¨¡å—ï¼Œè·³è½¬åˆ°ä¸“æ é¡µé¢
          else if (title === 'ä¸“æ æ–‡ç« ') {
            let columnType = 'depth'; // é»˜è®¤æ·±åº¦è§£æ
            if (item.tag === 'æŠ€æœ¯') {
              columnType = 'tech';
            } else if (item.tag === 'è§‚å¯Ÿ') {
              columnType = 'observe';
            }
            
            router.pushUrl({
              url: 'pages/fm_columnpage',
              params: {
                columnId: (idx + 1).toString(),
                columnName: item.title,
                columnAuthor: item.author,
                columnType: columnType
              }
            });
          }
        })
      }, (item: SectionItem) => item.title)
    }
    .width('100%')
    .margin({ bottom: 40 })
  }

  // è·å–å·¥å…·å›¾æ ‡çš„æ–¹æ³•
  private getToolIcon(title: string): string {
    switch (title) {
      case 'å†¥æƒ³ç»ƒä¹ ':
        return 'ğŸ§˜â€â™€ï¸'
      case 'å‘¼å¸è®­ç»ƒ':
        return 'ğŸ’¨'
      case 'å‹åŠ›è¯„ä¼°':
        return 'ğŸ“Š'
      default:
        return 'ğŸ”§'
    }
  }

  // è·å–å·¥å…·ç±»å‹çš„æ–¹æ³•
  private getToolType(title: string): string {
    switch (title) {
      case 'å†¥æƒ³ç»ƒä¹ ':
        return 'meditation'
      case 'å‘¼å¸è®­ç»ƒ':
        return 'breathing'
      case 'å‹åŠ›è¯„ä¼°':
        return 'assessment'
      default:
        return 'tool'
    }
  }
} 